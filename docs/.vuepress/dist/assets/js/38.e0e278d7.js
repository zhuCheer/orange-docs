(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{358:function(e,t,a){"use strict";a.r(t);var n=a(25),r=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"控制器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制器"}},[e._v("#")]),e._v(" 控制器")]),e._v(" "),a("h2",{attrs:{id:"定义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定义"}},[e._v("#")]),e._v(" 定义")]),e._v(" "),a("p",[e._v("在 orange 框架中，控制器是这样一个函数 "),a("code",[e._v("func(ctx *app.Context) error")]),e._v("，如下是典型的控制器定义")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('import (\n   "gitee.com/zhucheer/orange/app"\n)\n\nfunc Welcome(c *app.Context) error {\n\n   return c.ToJson(map[string]interface{}{\n      "info": "orange is a fast api framework",\n   })\n}\n\n')])])]),a("h2",{attrs:{id:"请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求"}},[e._v("#")]),e._v(" 请求")]),e._v(" "),a("h3",{attrs:{id:"获取参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取参数"}},[e._v("#")]),e._v(" 获取参数")]),e._v(" "),a("h4",{attrs:{id:"get参数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#get参数"}},[e._v("#")]),e._v(" GET参数")]),e._v(" "),a("p",[e._v("通过控制的中的 Request 可以获得原始 request；使用 FormValue 即可获得 GET 参数；")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('c.Request().FormValue("token")\n')])])]),a("h4",{attrs:{id:"post-get-参数获取统一方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#post-get-参数获取统一方案"}},[e._v("#")]),e._v(" POST / GET 参数获取统一方案")]),e._v(" "),a("p",[e._v("在 orange 中通过 "),a("em",[a("strong",[e._v("参数绑定")])]),e._v(" 的方式可以获取 GET/POST 参数，参数绑定方式能获取表单提交类型的参数和json类型的参数，兼容性较好。")]),e._v(" "),a("p",[e._v("具体代码如下：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('...\nfunc Welcome(c *app.Context) error {\n    req := struct {\n       Id int `json:"id"`\n    }{}\n   err := c.ParseForm(&req)\n   if err != nil {\n      return c.ResponseWrite([]byte("参数解析错误"))\n   }\n\n...\n}\n...\n')])])]),a("blockquote",[a("p",[e._v("注意：请求参数中包含&、>、<等特殊符号时需要进行 urlencode 编码，通过参数绑定后会自动进行 urldecode 解码；\n例如传递参数是一个 url 时，需要对该参数进行 urlencode 后传入。")])]),e._v(" "),a("h3",{attrs:{id:"请求响应"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#请求响应"}},[e._v("#")]),e._v(" 请求响应")]),e._v(" "),a("p",[e._v("Orange 对原生http响应进行了封装，有如下方法快速处理http响应")]),e._v(" "),a("ul",[a("li",[e._v("c.ResponseWrite([]byte) 输出原始响应内容")]),e._v(" "),a("li",[e._v("c.ResponseHeader() 配置/获取响应头")]),e._v(" "),a("li",[e._v("c.ToJson(interface{}) 以json的方式输出响应")]),e._v(" "),a("li",[e._v("c.ToString(string) 以字符串的方式输出响应")]),e._v(" "),a("li",[e._v('c.ToFile("./storage/file.txt", "fileName") 以文件流方式输出一个文件，浏览器会提示下载文件')]),e._v(" "),a("li",[e._v('c.ToImage("./storage/logo.png") 以文件流方式输出一个图片，浏览器会直接显示该图片')])]),e._v(" "),a("p",[e._v("代码参考")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('...\nfunc Welcome(c *app.Context) error {\n    return c.ResponseWrite([]byte("欢迎访问orange框架")) \n...\n}\n\nfunc WelcomeJson(c *app.Context) error {\n    return c.ToJson(map[string]interface{}{\n       "info": "orange is a fast api framework",\n    })\n}\n\nfunc WelcomeText(c *app.Context) error {\n    c.ResponseHeader().Set("Content-Type","application/text")\n    return c.ToString( "orange is a fast api framework")\n}\n\n...\n')])])]),a("h3",{attrs:{id:"控制器异步后置操作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#控制器异步后置操作"}},[e._v("#")]),e._v(" 控制器异步后置操作")]),e._v(" "),a("p",[e._v("在特定的业务中，我们可能需要在请求正常返回后进行一些用户不可见的处理逻辑；\n例如：后台业务中的行为记录，批量插入异步处理等等；\nOrange 框架提供了后置操作的能力；使用如下：")]),e._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('// 控制器方法\nfunc Welcome(c *app.Context) error {\n\n    // 添加一个后置执行方法，包含一个执行方法和一个延时时间两个参数\n   c.AddDelayAfterDo(func(ctx *app.Context) {\n      fmt.Println(string(ctx.ResponseBody()), ctx.OrangeInput.IP())\n   }, time.Second)\n   return c.ToString("hello world！")\n}\n')])])])])}),[],!1,null,null,null);t.default=r.exports}}]);