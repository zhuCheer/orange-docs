# æ¶ˆæ¯é˜Ÿåˆ—

åœ¨æ—¥å¸¸ä¸šåŠ¡å¼€å‘éœ€æ±‚ä¸­ï¼Œç»å¸¸ä¼šç”¨åˆ°æ¶ˆæ¯é˜Ÿåˆ— rocketmqï¼Œnsqï¼Œkafkaç­‰å·¥å…·æ¥å®Œæˆè¯¸å¦‚æ’é˜Ÿï¼Œç§’æ€ï¼Œå¼‚æ­¥å¤„ç†ç­‰ä¸šåŠ¡ï¼›


ä¸ºäº†èƒ½è®©æˆ‘ä»¬æ–¹ä¾¿å¿«æ·çš„æ¥å…¥å„ç§æ¶ˆæ¯é˜Ÿåˆ—ï¼ŒOrangeæ¡†æ¶å¯¹æ—¥å¸¸ä½¿ç”¨çš„é˜Ÿåˆ—ç”Ÿäº§/é˜Ÿåˆ—æ¶ˆè´¹è¿›è¡Œäº†å°è£…ï¼ŒåŸºäºæ¥å£è¿›è¡Œå®ç°ï¼Œæ— è®ºä½¿ç”¨ä½•ç§æ¶ˆæ¯é˜Ÿåˆ—ï¼Œéƒ½åªæ˜¯ä¸€ä¸ªé…ç½®çš„é—®é¢˜ï¼›


é¢†å¯¼è¯´ç”¨rocketmqæˆ‘ä»¬å°±ç”¨rocketmqï¼Œé¢†å¯¼è¯´æ¢æˆredisï¼Œæˆ‘ä»¬å°±ç»™ä»–æ¢æˆredisï¼Œå®Œå…¨ä¸æ…Œï¼Œæå¤§ç®€åŒ–æ¥å…¥æˆæœ¬ï¼›ğŸ˜ğŸ˜ğŸ˜


## ç»„ä»¶è¯´æ˜
- ç»„ä»¶åŸºäºæ¥å£å®ç°ï¼Œä¸åŒçš„æ¶ˆæ¯é˜Ÿåˆ—é€šè¿‡é…ç½®æ–‡ä»¶æŒ‡å®š
- ç›®å‰æ”¯æŒäº† rocketmqã€redisé©±åŠ¨ï¼›

## é…ç½®è¯´æ˜
å¦‚ä¸‹æ˜¯å®Œæ•´çš„é…ç½®é€‰é¡¹ï¼š
~~~
[queue]
    driver="redis" // rocketmq æˆ– redis
    retry=2 // é‡è¯•æ¬¡æ•°
    endpoints=["192.168.1.1:6379"] // brocker æˆ– redis æœåŠ¡åœ°å€ï¼Œå½“ç”¨redisé©±åŠ¨æ˜¯åªç”¨å¡«ä¸€ä¸ªä¸»åº“åœ°å€å³å¯
    passwd="123456" // redisé©±åŠ¨ä¸“å±é…ç½®ï¼Œrediså¯†ç 
    redisdb=4 // redisé©±åŠ¨ä¸“å±é…ç½®ï¼Œredisåº“ç¼–å·
    timeout=3600 // redisä¸“å±é…ç½®ï¼Œé˜Ÿåˆ—è¶…æ—¶æ—¶é—´(s) ï¼Œå½“é˜Ÿåˆ—ä¸€ç›´æ²¡æœ‰è¢«æ¶ˆè´¹åˆ°è¾¾è¶…æ—¶æ—¶é—´åˆ™é˜Ÿåˆ—ä¼šè¢«é”€æ¯
~~~

## ä½¿ç”¨æŒ‡å—

### æ³¨å†Œç”Ÿäº§è€…
- é€šè¿‡å¦‚ä¸‹ä»£ç æ³¨å†Œç”Ÿäº§è€…å¹¶å‘é˜Ÿåˆ—å‘é€ä¸€æ¡æ¶ˆæ¯ï¼›
- å‚æ•°è¯´æ˜ï¼Œæ³¨å†Œæ–¹æ³• `NewProducer` éœ€è¦ä¼ å…¥é˜Ÿåˆ— group åç§°ï¼›
- æ¶ˆæ¯å‘é€æ–¹æ³• `SendMsg` éœ€è¦æŒ‡å®šæ¶ˆæ¯é˜Ÿåˆ— topic åç§°å’Œæ¶ˆæ¯ä½“å†…å®¹ï¼›

~~~
client, _:= queue.NewProducer("test")
ret, err := client.SendMsg("test-topic", "Hello Worldï¼")
~~~

### æ³¨å†Œæ¶ˆè´¹è€…

æ¶ˆè´¹è€…é‡‡ç”¨çš„æ˜¯ç›‘å¬å¹¶æ‰§è¡Œå›è°ƒæ–¹æ³•çš„æ¨¡å¼å®ç°ï¼Œæ³¨å†Œå¥½æ¶ˆè´¹è€…åï¼Œç¨‹åºä¼šæŒç»­åœ°ç›‘å¬é˜Ÿåˆ—å¹¶æ¶ˆè´¹æ•°æ®ï¼›


å’Œç”Ÿäº§è€…ä¸€æ ·ï¼Œæ¶ˆè´¹è€…æ–¹æ³• `NewConsumer` éœ€è¦ä¼ å…¥é˜Ÿåˆ— group åç§°ï¼›


æ¶ˆè´¹è€…æ¶ˆæ¯ç›‘å¬æ–¹æ³• `ListenReceiveMsgDo` ä¼ å…¥æ¶ˆæ¯ topic å’Œä¸€ä¸ªæ¶ˆæ¯å¤„ç†çš„å›è°ƒæ–¹æ³•ï¼Œæ¥å—åˆ°æ¶ˆæ¯åçš„å¤„ç†é€»è¾‘éƒ½æ”¾åœ¨è¯¥å›è°ƒæ–¹æ³•ä¸­å³å¯å®Œæˆæ¶ˆè´¹æµç¨‹ï¼›

~~~
client, _ := queue.NewConsumer("test")

client.ListenReceiveMsgDo("test", func(mqMsg queue.MqMsg) {
   fmt.Println("recive===>", mqMsg, mqMsg.BodyString())
})
~~~
 

### å®Œæ•´ç¤ºä¾‹
- å…ˆå‡†å¤‡å¥½ä¸€ä¸ªredisæœåŠ¡ä½œä¸ºç¤ºä¾‹
- åœ¨ GOPATH ä¸‹åˆ›å»ºä¸€ä¸ªdemoç›®å½•ï¼Œç›®å½•ä¸­åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶ main.go, config.toml;

~~~
main.go
------------------
package main

import (
   "gitee.com/zhucheer/orange/app"
   "gitee.com/zhucheer/orange/queue"
   "fmt"
)

func main(){
   router := &Route{}
   app.AppStart(router)
}

type Route struct {
}

func (s *Route) ServeMux() {
   app.NewRouter("").GET("/", func(ctx *app.Context) error {
   
     client, _ := queue.NewProducer("test")

     ret, _ := client.SendMsg("test", "hello mq producer!")
   
      return ctx.ToJson(ret)
   })
}

func (s *Route) Register() {


   client, _ := queue.NewConsumer("test")
   client.ListenReceiveMsgDo("test", func(mqMsg queue.MqMsg) {
      fmt.Println("recive msg===>", mqMsg.BodyString())
   })

}
~~~

åœ¨é…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¥½å¯¹åº”çš„redisæœåŠ¡ä¿¡æ¯
~~~
config.toml
------------------
[queue]
    driver="redis"
    retry=2
    endpoints=["192.168.1.1:6379"]
    passwd="123456"
    redisdb=4
    timeout=3600
~~~

æœ€åæ‹‰å–ä¾èµ–å¹¶æ‰§è¡Œï¼ˆå¼€å¯ go modulsï¼‰
```
go mod init
go mod tidy
go run main.go --config=config.toml

```
ç¨‹åºå¯åŠ¨åè®¿é—® http://127.0.0.1:8088/ å³å¯çœ‹åˆ°ç”Ÿäº§å’Œæ¶ˆè´¹çš„è¿‡ç¨‹ï¼›




